{{#partial "links"}}
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
{{/partial}}
{{#partial "contenido"}}
    <div class="row">
         <div class="col-md-12">
            <div class="form-container bg-white p-4 rounded shadow">
                <h1 class="text-center text-primary">Heladeras instaladas</h1>

                <div class="form-group mb-3 col-12">
                    <!-- Mapa Leaflet para selección de ubicación -->
                    <div id="map" style="height: 400px; border: 1px solid #ccc; border-radius: 4px;"></div>
                    <input type="hidden" id="lat" name="lat">
                    <input type="hidden" id="lng" name="lng">
                    <input type="hidden" id="direccion" name="direccion">
                </div>

                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Ubicación</th>
                        <th>Capacidad Máxima</th>
                        <th>Viandas Actuales</th>
                        <th>Desperfecto</th>
                        <th>Acciones</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{#each heladeras}}
                        <tr>
                            <td>{{this.nombre}}</td>
                            <td>{{this.ubicacion.direccion}}</td>
                            <td>{{this.cantMaxViandas}}</td>
                            <td>{{this.cantViandasActuales}}</td>
                            <td>{{#if this.desperfecto}} Sí {{else}} No {{/if}}</td>
                            <td>
                                <a href="/heladeras/{{this.id}}" class="btn btn-primary">Ver detalles</a> <!-- Botón -->
                            </td>
                        </tr>
                    {{/each}}
                    </tbody>
                </table>

                <div class="text-center mt-4">
                    <a href="/" class="btn btn-outline-primary">Volver al Inicio</a>
                </div>
            </div>
        </div>
    </div>
{{/partial}}
{{#partial "scripts"}}
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
    // Este código se ejecutará cuando la página se haya cargado completamente
    document.addEventListener('DOMContentLoaded', function() {

        // Inicialización del mapa
        var map = L.map('map').setView([-34.603722, -58.381592], 18);

        // Añadir el mapa base de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        heladeras.forEach(heladera =>{
            var customIcon = L.icon({
                iconUrl: '/assets/img/icon.png',  // Ruta al archivo PNG
                iconSize: [40, 40], // Tamaño del ícono en píxeles [ancho, alto]
                iconAnchor: [25, 50], // Punto donde el ícono apunta en el mapa [ancho/2, alto]
                popupAnchor: [0, -50] // Punto desde donde se muestra el popup
            });
             var lat = {{heladera.ubicacion.latitud}};
             var lng = {{heladera.ubicacion.longitud}};

            L.marker([lat, lng], {icon: customIcon}).addTo(map)
            .bindPopup('{{heladera.nombre}}')
            .openPopup();
        });
    });
    initMap();
</script>
{{/partial}}
{{> templates/base title="HELADERAS INSTALADAS"}}